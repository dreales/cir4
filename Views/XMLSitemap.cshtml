@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using Umbraco.Core.Models
@using Umbraco.Web
@helper ListChildNodes(IPublishedContent startNode){
  foreach (var node in startNode.Children.Where(x => Umbraco.MemberHasAccess(x.Id, x.Path)).Where(x => !Umbraco.IsProtected(x.Id, x.Path)).Where(x => x.IsVisible())){
    if (node.TemplateId > 0 && node.GetPropertyValue<string>("excludeFromSitemap") == "False"){
      <url>
        <loc>@node.UrlWithDomain()</loc>
        <lastmod>@(string.Format("{0:s}+00:00", node.UpdateDate))</lastmod>
      </url>
    }
    if (node.Level <= 10 && node.Children.Any()){
     @ListChildNodes(node)
    }
  }
}
@{
  Layout = null;
  ListChildNodes(Content.AncestorOrSelf(1));
}